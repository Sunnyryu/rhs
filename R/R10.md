## R

#### R Study

```R
install.packages("sqldf")
 library(sqldf)
 print(Fruits)
 str(Fruits)
 sqldf(" select * from Fruits")

 >   sqldf(" select * from Fruits")
     Fruit Year Location Sales Expenses Profit       Date
 1  Apples 2008     West    98       78     20 2008-12-31
 2  Apples 2009     West   111       79     32 2009-12-31
 3  Apples 2010     West    89       76     13 2010-12-31
 4 Oranges 2008     East    96       81     15 2008-12-31
 5 Bananas 2008     East    85       76      9 2008-12-31
 6 Oranges 2009     East    93       80     13 2009-12-31
 7 Bananas 2009     East    94       78     16 2009-12-31
 8 Oranges 2010     East    98       91      7 2010-12-31
 9 Bananas 2010     East    81       71     10 2010-12-31


 #Apple 데이터 행만 추출
 sqldf("select * from Fruits where Fruit= 'Apples'")

 #처음부터 3개의 행만 추출
 sqldf('select * from Fruits limit 3' )

 #Sales 컬럼변수값으로 내림차순 정렬
 sqldf('select * from Fruits order by  Sales  desc' )  


 #Sales 컬럼의 누적합, 최소값, 최대값, 평균
 sqldf('select sum(Sales), min(Sales), max(Sales), avg(Sales)
 from Fruits ' )

 #Fruit 과일 종류별  Sales 컬럼의 누적합, 최소값, 최대값, 평균, 행개수
 sqldf('select sum(Sales), min(Sales), max(Sales), avg(Sales)
 from Fruits  group by Fruit' )
>   sqldf('select sum(Sales), min(Sales), max(Sales), avg(Sales) from Fruits ')
  sum(Sales) min(Sales) max(Sales) avg(Sales)
1        845         81        111   93.88889
>   sqldf('select sum(Sales), min(Sales), max(Sales), avg(Sales) from Fruits group by Fruit')
  sum(Sales) min(Sales) max(Sales) avg(Sales)
1        298         89        111   99.33333
2        260         81         94   86.66667
3        287         93         98   95.66667
```

```R
mpg <- as.data.frame(ggplot2::mpg)  
mpg
mpg2 <- mpg %>% group_by(manufacturer) %>% filter(class=="suv") %>% mutate(tot=(cty+hwy))%>% mutate(tot=(cty+hwy)/2
) %>% summarise(mean_tot=mean(tot)) %>% arrange(desc(mean_tot)) %>% head(5)
print(mpg2)

sqldf5 <- sqldf("select class, (cty+hwy)/2 as tot, avg((cty+hwy)/2)
from mpg
where class = 'suv'
group by manufacturer
order by 3 desc")
head(sqldf5, 5)

> head(sqldf5, 5)
  class tot avg((cty+hwy)/2)
1   suv  21         21.66667
2   suv  17         16.12500
3   suv  15         15.75000
4   suv  15         15.50000
5   suv  14         15.22222

  manufacturer mean_tot
  <chr>           <dbl>
1 subaru           21.9
2 toyota           16.3
3 nissan           15.9
4 mercury          15.6
5 jeep             15.6

mpg3 <- mpg %>% filter(class=="compact") %>% group_by(manufacturer) %>% summarise(count=n()) %>% arrange(desc(count))
print(mpg3)

> mpg3 <- mpg %>% filter(class=="compact") %>% group_by(manufacturer) %>% summarise(count=n()) %>% arrange(desc(count))
> print(mpg3)
# A tibble: 5 x 2
manufacturer count
 <chr>        <int>
1 nissan           2
2 subaru           4
3 toyota          12
4 volkswagen      14
5 audi            15

sqldf("select class, count(*)
 from mpg
 where class='compact'
 group by manufacturer
 order by 2")
 class count(*)
1 compact        2
2 compact        4
3 compact       12
4 compact       14
5 compact       15
```

R 데이터 분석 프로세스
- 기초 통계(descriptive statistics)
데이터에 대한 통계적 자료분석에 앞서 데이터의 대략적인 통계적 수치를 계산해 봄으로써 데이터에 대한 대략적인 이해와 앞으로 진행될 분석에 대한 insight 얻기 위한 분석방법
- 변수 (Variable)
수집된 자료에서 관심의 대상이 되는 특성이나 관측된 결과로서 주어지는 특성
- 변수의 유형
  - 질적변수(Qualitative Variable) 또는 범주형 변수(Categorial Variable) 특성을 범주로 구분해서 나타내는 변수
    - ex) 성별구분(남자:1 , 여자 :2) ,  소득수준 (상, 중, 하)
- 양적변수(Quantative Variable) – 연속형 변수(continuous Variable), 이산형 변수(Discrete Variable)
```
양적변수 :  관심대상이 되는 특성을 수치로 나타내는 변수
ex) 몸무게, 키, 환자의 나이
독립변수 : 다른 변수에 영향을 주는 변수 (원인변수, 설명변수, 예측변수)
종속변수 : 다른 변수에 영향을 받는 변수 (결과변수, 피설명변수, 피예측변수)
ex) '흡연은 폐암을 유발한다'에서  흡연은 독립변수, 폐암은 종속변수
```

- 자료에 형태에 따른 분류

자료 유형  | 정의  
--|--
명목척도 자료   |  단지 구분하기 위한 부호로 표현된 자료(성별, 혈액형, 주거형태, 학과
서열척도 자료   |  관측되는 개체들에 순서를 갖는 자료 (학년, 선호도, 신용등급)
구간척도 자료   |  관측 값의 순서와 순서사이의 간경이 의미가 있는 자료 (성적, 온도 등)
비율척도 자료   |  두 간격(차이)에 대한 비율이 의미를 갖는 자료(연령, 시간, 거리)


- 분석 절차와 통계지식
```
분석 절차
    가설 설정
    유의 수준 결정
    측정도구 선정
    데이터 수집(설문지, 웹, SNS)
    데이터 코딩/프로그래밍
    통계분석 수행(R, SPSS, SAS)
    결과 분석(논문/보고서 작성

연구 조사
    연구문제 선정 단계 - 연구의 독창성, 검증 가능성, 결과의 실용성, 구체성, 경제성(소모비용, 노력)을 고려
    예비조사 단계 – 연구 문제에 대한 사전지식을 수집하고, 중요 변수를 규명하며, 가설을 도출하기 위한 과정으로 문헌 조사나 전문가조사, 사례 조사방법 등이 있음 (사전조사는 측정도구(설문지))를 작성한뒤에 실시
    연구 모형 설계 단계 – 변수와 개념을 식별하여 영향을 미치는 변수와 영향을 받은 변수를 식별하고, 이들 변수 간의 관계를 설계하는 과정

가설 (hypothesis)
    실증적인 증명에 앞서 세우는 잠정적인 진술
    나중에 논리적으로 검증될 수 있는 명제
    통계 분석을 통해서 채택 또는 기각될 수 있음

가설 유형
    귀무가설(영가설) : ‘두 변수 간의 관계가 없다‘ 또는 ‘차이가 없다＇라는 부정적 형태로 진술하는 기설로 ‘H0’으로 표시함 (예: 교육수준이 높은 집단과 낮은 집단 간에는 국가 정책에 대한 비판적 태도에서 차이가 없음)
    연구가설(대립가설) : 검정할 가설의 내용에는 ‘차이가 있다’ 또는 ‘효과가 있다＇라고 진술하는 가설 ‘H1’로 표시함 연구가설은 검정하고자 하는 현상에 관한 예측이며 대립가설 혹은 대체가설이라고함 (예: 신약A는 A암 치료에 효과가 있음)  

가설 (hypothesis)의 요건
    검증성 : 이론적으로 검증 가능해야함
    한정성  한정적, 특정적이어야함
    측성화 : 변수 관계를 경험적 사실에 근거하여 측정 가능해야함
    계량화 : 계량적 형태를 취하거나 계량화할 수 있어야함
    명백성 : 가설의 표현은 간단 명료해야함
    입증성 : 명백하게 입증할 수 있어야함
    연관성 : 동일 연구 분야, 다른 가설이나 이론과 연관이 있어야함  
```
  ![Deepin스크린샷_select-area_20190917094828](https://i.imgur.com/1hw1bA7.png)
```
유의수준 결정
    연구가설의 채택 또는 기각은 유의수준(Significant level)을 기준으로 하여 가설 채택 여부가 결정됨
    분석 결과가 유의수준 내에 들어가면 가설은 채택되고, 그렇지 않으면 기각됨
    유의수준은  α 또는 P(probability : 확률)로 표시함
    사회과학 분야에서는  α=0.05 또는 p<0.05를 기준으로 함. (오차가 5%이며, 표본통계치가 신뢰도가 95%라는 것을 의미함)
    일반적으로 유의수준은 0.1, 0.05, 0.01 등의 값을 적용하고 있으며
    의.생명을 다루는 분야는 오차범위를 최소화하기 위해서 α=0.01 또는 p<0.01을 기준으로 99% 신뢰도를 확보하고 1% 오차만 인정하는 임계치를 정하기도 함

유의확률(p)
    귀무가설을 기각할 수 있는 최소의 유의수준을 의미함
    유의확률이 유의수준보다 작은 경우 (p< α) 귀무가설을 기각함
    유의확률이 유의수준보다 큰 경우 (p > α) 귀무가설을 채택함
    유의확률이 유의수준보다 작다는 것은 관측치가 귀무가설 기각역에 있다는 것을 의미함    

    통계적으로 유의하다  – 확률적으로 볼때 단순히 우연이라고 생각되지 않을 정도로 의미가 있다는 뜻
    통계적으로 유의하지 않다 – 실험 결과가 단순한 우연일 수도 있다는 뜻
    가설 검정에서 검정통계량(통계값)과 연구자가 설정한 수준(유의수준)을 비교 및 판단하여 귀무가설을 기각할 때, 연구가설이 ‘통계적으로 유의하다＇라고 표현함

객체(Object)
    연구 대상의 단위로 여러 개의 속성으로 구성됨
속성(Attribute)
    변수 또는 변인
변수의 유형
    독립변수(Independent variable) : 종속변수에 영향을 주는 변수(설명변수)
    종속변수(dependent variable) : 독립변수의 영향을 받아 변화될 것으로 예측되는 변수(반응변수)
    매개변수(Intervening) : 두 변수를 중간에서 연결해주는 변수
    조절변수(Control variable) :  독립변수와 종속변수 사이의 관계 강도를 조절해주는 변수
    외생변수(Extraneous) : 독립변수가 아니면서 종속변수에 영향을 미치는 변수    
  ```    
![Deepin스크린샷_select-area_20190917101836](https://i.imgur.com/5eF1kVk.png)

```
척도(Scale)
    연구 대상을 측정하기 위한 측정도구
    응답다가 변인의 값을 선택할 수 있도록 일련의 기호 또는 숫자로 나타내어 변수를 측정하게 하는 단위
측정수준
측정 : 추상적인 개념이나 변수를 일정한 규칙에 따라 수치를 부여하여 구체적인 지표로 나타내는 것
척도 구성의 기본 원칙
    분류된 범주는 다른 범주와의 관계에서 상호배타적이어야함
    응답범주들이 응답 가능한 모든 상황을 포함해야함
    응답 범주들이 논리적인 일관성을 가지고 있어야함
    여러 개의 문항 간에는 상호 내적 일관성을 가져야함

척도(Scale)의 분류
    명목척도(Nominal scale) : 단순히 속성을 분류할 목적으로 명목상 숫자를 부여한 척도로 연산은 불가능한 변수임 (연산은 가능하지만 의미가 없음)
    예) 성별(1=남자, 2=여자), 연령별, 학력, 종료, 취미등


    서열척도(Ordinal scale) : 측정 대상 간의 크고 적음, 양의 많고 적음, 선호도의 높고 낮음 등과 같이 순서 관계를 밝혀주는 척도로 연산은 불가능한 변수


    등간척도(Interval scale) : 측정 대상의 속성에 대한 각 수준 간의 간격이 동일한 척도로 간격이 일정하여 덧셈과 뺄셈 연산이 가능한 변수, 또한 절대 원점(0)을 가지고 있지 않기 때문에 0이 아무것도 없는 것을 의미하지 않기 때문에 몇 배라고 이야기할 수 없는 척도
    측정도구 작성에 가장 많이 이용되는 척도임
    예) 시각(년도, 시각, 월), 섭씨온도, 화씨온도


    비율척도(Ratio) : 척도의 수가 등간이며, 절대 원점(0)을 가지고 있는 척도를 말함 즉 속성이 0을 기준으로 한 수치로 되어있기 때문에 사칙연산이 모두 가능한 변수로 등간척도와 함께 많이 이용되는 척도임
    예) 성적, 키, 무게, 인구수, 수량, 길이 금액등    

정성적-질적 척도(범주형 변수)와 정량적-양적 척도(연속형 변수) 분류
```
  정성적-질적 척도   |(범주형 변수) | 정량적-양적 척도  | (연속형 변수) |
--|---|---|--
명목척도  |  이름이나 범주를 대표하는 의미 없는 숫자(예: 남자 -1, 여자-2) | 등간척도  |  속성에 대한 각 수준 간의 간격이 동일한 경우(가감산 연산) (예: 연소득이 어디에 해당합니까?)
서열척도  | 측정 대상 간의 높고 낮음(서열), 순서에 대한 값 부여 (예: 좋아하는 순위를 표시하시오)   |비율척도   |   등간척도의 특성에 절대 원점(0)이 존재하고 비율계산이 가능한 경우(사칙연산) (예: 나이가 몇 세입니까?)

```
데이터 수집
    선정된 측정 도구를 이용하여 설문 문항을 작성하고, 오프라인과 온라인(웹, SNS)을 통해서 데이터를 수집하는 단계
    데이터 코딩
    데이터의 수집을 통해서 획득한 데이터를 통계 분석 프로그램(R, Python, SPSS, SAS, Excel)을 이용하여 데이터를 입력(코딩)하는 단계
    사용자의 응답 결과를 숫자나 기호 등을 이용하여 데이터를 입력하는 과정

코딩 시 주의사항
    응답이 부실한 설문자와 무성의하게 응답한 설문지를 선별하여 제거함
    설문지 앞면에 일련번호를 순서대로 기입하여 데이터 입력 손실을 막음
    가능하면 모든 항목을 숫자로 입력해야 분석이 용이함
    ‘무응답＇과 같은 결측치(Missing Values) 항목에 대해서는 분석 도구에 맞게 NA(R), NAN(Python), 999(SPSS, SAS)등을 부호화함
    숫자나 문자를 직접 입력하는 자유 형식은 입력될 수 있는 가장 큰 값을 고려하여 폭(Width)를 배정함
    개방형보다 폐쇄형(고정형식)으로 코딩하는 것이 바람직하다.(예: 거주지를 기입하는 방식보다 선택항목중 하나를 선택하도록 함)
```

통계 분석 방법과 변수 척도 관계
분석방법  |적용분야   | 변수 척도  
--|---|--
빈도 분석  | 가장 기초적이고, 간단한 분석방법으로 변수의 분포를 제공하며 인구 통계적 특성을 제시하는데 용이함  |   모든 척도
교차분석(카이제곱)  | 변수 간의 분포와 백분율을 나타내는 교차표를 작성하고 두 변수 간의 독립성과 관련성(카이제곱검정)을 분석한다  |  명목척도, 서열척도
  요인분석| 측정하려는 변수들의 상관관계가 높은 것끼리 묶어서 변수를 단순화하는 데 이용함 (타당성 검정) 잘못 적재된 변수나 설명력이 부족한 변수를 제거한다.  |  등간척도, 비율척도
  신뢰도 분석| 요인분석으로 추출된 요인들이 동질적인 변수들로 구성되어 있는가를 파악하는 분석방법  |  등간척도, 비율척도
  상관관계 분석| 설정한 가설을 검정하기 전에 모든 연구가설에 사용되는 측정변수 간의 관계 정도를 세하여 변수 간의 관련성에 대한 윤곽을 제시  |  피어슨-등간척도, 비율척도
  회귀분석|  독립변수가 종속변수에 어떠한 영향을 미치는지 파악하기 위해 실시하는 분석방법 (두 변수 인과관계 분석) |  등간 척도, 비율 척도
  t- 검정| 종속변수에 대한 독립 변수의 집단 간 평균의 차이를 검정함, 독립표본 t-test와 대응표본 t-test 분류  |  독립변수 : 명목척도 종속변수 : 등간척도 또는 비율척도
  분산분석(anova)  | t-검정과 같이 집단 간 평균의 차이를 구하는 분석 기법으로 다른 점은 3집단 이상의 평균을 검정할 때 이용된다.  |  독립변수 : 명목척도 종속변수 : 등간척도또는 비율척도
```
분석 결과 제시
    연구 목적과 연구가설에 대한 검증을 중심으로 분석하는 단계, 단순한 통계 결과 제시보다는 인구 통계학적 특성을 시작으로 결과의 의미를 해석하고, 연구자의 개인적인 의견을 기술하여 분석 결과를 제시함
    [단계 1] 연구목적과 연구가설에 대한 분석 및 검증 단계
    [단계 2] 인구통계학적 특성 변수 제시 단계
    [단계 3] 주요 변인에 대한 기술 통계량 제시 단계
    [단계 4] 연구가설에 대한 통계량 검정 및 해석 단계
    [단계 5] 연구자 의견 기술 및 논문/보고서 마무리 단계
```
통계학(Statistics)
  - 논리적 사고와 객관적인 사실에 따르며, 일반적이고 확률적 결정론에 따라서 인과관계를 규명함
  - 이용 분야에 따른 통계학의 구분

구분  |기술(Descriptive) 통계학   |  추론(Inferential) 통계학
--|---|--
기능  |수집된 자료의 특성을 쉽게 파악하기 위해서 자료를 정리 및 요약   |  표, 그래프, 대표값 등
방법  | 모집단에서 추출한 표본의 정보를 이용하여 모집단의 다양한 특성을 과학적으로 추론 |  회귀분석, T-검정, 분산분석 등

```
전수조사
    모집단 내에 있는 모든 대상을 조사하는 방법
    예) 전 국민을 대상으로 한 인구조사
    정체를 대상으로 실시하기 때문에 모집단의 특성을 정확히 반영할 수 있음
    시간과 비용이 많이 소요되는 단점
표본 조사
    모집단으로부터 추출된 표본을 대상으로 분석을 실시하기 때문에 전수 조사의 단점을 보완할 수 있음
    모집단의 특성을 반영하는 표본이 추출되지 못하는 경우 수집된 자료가 무용지물이 될 수 있음
    예) 선거 여론 조사, 마케팅 조사, 산업현창의 안전성 검사, 의.생명 분야 임상 실험
모집단(Population)
    통계적 관찰 대상이 되는 개체의 전체집합
표본
    모집단에서 조사대상으로 추출된 부분집합
```

  - 모수와 통계량 표시

  구분  | 모수(모집단)  |    통계량(표본)
--|---|--
  의미  | 모집단의 특성을 나타내는 수치  |    표본의 특성을 나타내는 수치
표기  |그리스, 로마자  |  영문 알파벳
평균  |μ  (모평균)   |   x (표본의 평균)
표준편차  |   б (모표준편차)  |    S (표본의 표준편차)
  분산  | б^2 (모문산)  |  S2 (표본의 분산)
대상 수  |   N(사례수)  |  N  (표본수)

```
통계적 추정
    모집단의 특성을 파악하기 위해서 모집단의 특성을 대표하는 표본을 추출하고, 이러한 표본을 이용하여 모집단의 특성을 나타내는 각종 모두(모평균, 모분산 등)를 예측하는 방법

통계적 추정 방법
    - 점추정
      모집단의 특성을 하나의 값으로 추정하는 방식
      모두와 동일한 가능성이 가장 큰 하나의 값을 선택하는 방법으로 가능성은 희박함

    - 구간 추정
      모집단의 특성을 적절한 구간을 이용하여 추정하는 방식
      모수가 속하는 일정 구간(하한값, 상한값으로 추정하기 때문에 일반적으로 많이 사용한다

구간추정 주요 용어
      신뢰수준(Confidence Level) : 계산된 구간이 모두를 포함할 확률을 의미하며, 통상 90%, 95%, 99%등으로 표현함
      신뢰구간(Confidence Interval) : 신뢰수준하에서 모두를 구간으로 (하한값, 상한값)의 형식으로 표현함
      표본오차(Sampling Error) : 모집단에서 추출한 표본이 모집단의 특성과 정확히 일치하지 않아서 발생하는 확률의 차이를 의미함

      ex) 대통령 후보의 지지율 여론조사에서 어떤 후보의 지지율이 95% 신뢰수준에서 표본 오차 ±3% 범위에서 32.4%로 조사되었다고 가정한다면 실제 지지율은 29.4% ~35.4%(-3%~+3%) 사이에 나타날 수 있다는 의미!
```
