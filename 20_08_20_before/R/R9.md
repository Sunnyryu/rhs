## R

#### R Study

```R
install.packages("jsonlite")
library(jsonlite)
library(xml2)
library(rvest)
library(stringr)

url <- 'https://www.amazon.in/OnePlus-Mirror-Black-64GB-Memory/dp/B0756Z43QS?tag=googinhydr18418-21&tag=googinkenshoo-21&ascsubtag=aee9a916-6acd-4409-92ca-3bdbeb549f80'

# ì œëª©ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
webpage <- read_html(url)
title_html <- html_nodes(webpage, 'h1#title')
title <- html_text(title_html)
head(title)

#\rê³¼ \n ëŒ€ì‹ í•´ì„œ ""ìœ¼ë¡œ ë°”ê¾¸ê¸°
str_replace_all(title, "[\r\n]", "")

#ê°€ê²© ê°€ì ¸ì˜¤ê¸°
price_html <- html_nodes(webpage, 'span#priceblock_ourprice')
price <- html_text(price_html)
price <- str_replace_all(price, "[\r\n]", "")
head(price)

#ì œí’ˆ ì„¤ëª… ê°€ì ¸ì˜¤ê¸°
desc_html <- html_nodes(webpage, 'div#productDescription')
desc <- html_text(desc_html)
desc <- str_replace_all(desc, "[\r\n\t]", "")
head(desc)

#ë³„ì  ê°€ì ¸ì˜¤ê¸°
rank_html <- html_nodes(webpage,'span#acrPopover')
rank <- html_text(rank_html)
rank <- str_replace_all(rank, "[\r\n\t]", "")
rank <- gsub(" ","",rank)
head(rank)

#ìƒ‰ìƒ ë° ìš©ëŸ‰ ê°€ì ¸ì˜¤ê¸°
etc_html <- html_nodes(webpage, 'form#twister  ')
etc <- html_text(etc_html)
etc <- str_replace_all(etc, "[\r\n\t]", "")
etc <- gsub(" ","",etc)
head(etc)

#ë°ì´í„° í”„ë ˆì„í™” ì‹œí‚¤ê¸°
product_data <- data.frame(Title=title, Price=price, Description=desc,
                           Rank=rank, Size_Color=etc)
str(product_data)

# jsoní™” ì‹œí‚¤ê¸°
json_data <- toJSON(product_data)
cat(json_data)
```


```R
#dplyr ì—°ìŠµ  
library('dplyr')
sample_n(mtcars, 10)

sample_frac(mtcars, 0.2)

#ggplot2 ì—°ìŠµ
library(googleVis)
library(ggplot2)

motion <- gvisMotionChart(economics, idvar = "psavert", timevar = "date")
plot(motion)
```
![DeepinìŠ¤í¬ë¦°ìƒ·_select-area_20190916102403](https://i.imgur.com/lwuQjNQ.png)

```R
#dployr ì—°ìŠµ
gauge <- gvisGauge(CityPopularity, labelvar = "City", numvar = "Popularity", options = list(min = 0, max = 1000))
plot(gauge)
```
![DeepinìŠ¤í¬ë¦°ìƒ·_select-area_20190916102630](https://i.imgur.com/AaVGoiG.png)

```R
#dployr ì—°ìŠµ
register_google('key ê°’')
googleAPIkey = 'key ê°’'
gg_incheon <- get_googlemap("incheon", maptype = "terrain")
ggmap(gg_incheon)
```
![DeepinìŠ¤í¬ë¦°ìƒ·_select-area_20190916104803](https://i.imgur.com/0P2Kyov.jpg)

```R
# Practice

install.packages("readxl")
library("readxl")
ck <- read_excel("./data/ì¹˜í‚¨ì§‘_ê°€ê³µ.xlsx") # ì—‘ì…€ë°ì´í„° í• ë‹¹
head(ck)
addr <- substr(ck$ì†Œì¬ì§€ì „ì²´ì£¼ì†Œ, 10, 13) #ì†Œì¬ì§€ì „ì²´ì£¼ì†Œ ì—´ì—ì„œ 10~13ë²ˆì§¸ ì•ê¹Œì§€ ì¶”ì¶œ
head(addr)

addr_num <- gsub("[0-9]", "", addr) #ìˆ«ì ì œê±°
addr_trim <- gsub(" ", "", addr_num) # ê³µë°± ì œ #ë„ìˆ˜ë¶„í‘œí‘œ ì‘ì„± í›„ ë°ì´í„° í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜
head(addr_trim)

library(dplyr)
addr_count <- addr_trim %>% table() %>% data.frame()
head(addr_count)

install.packages("treemap")
library(treemap)

# ë™ì´ë¦„ ì—´(.)ê³¼ ì¹˜í‚¨ì§‘ ê°œìˆ˜ ì—´(Freq)ë¡œ íŠ¸ë¦¬ ë§µ í‘œí˜„
treemap(addr_count, index = ".", vSize = "Freq", title = "ì„œêµ¬ ë™ë³„ ì¹˜í‚¨ì§‘ ë¶„í‘œ")
arrange(addr_count, desc(Freq)) %>% print() # ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì‹¤ì œ ë°ì´í„° í™•ì¸
```
![DeepinìŠ¤í¬ë¦°ìƒ·_select-area_20190916112231](https://i.imgur.com/bA7y9M5.png)


```R
dustdata <- read_excel("./data/dustdata.xlsx")
View(dustdata)
str(dustdata)

dustdata_anal <- dustdata %>% filter(area %in% c("ì„±ë¶êµ¬", "ì¤‘êµ¬"))
View(dustdata_anal)
# ë°ì´í„° ì„¸íŠ¸ì— yyyymmddì— ë”°ë¥¸ ë°ì´í„° ìˆ˜ íŒŒì•…
count(dustdata_anal, yyyymmdd) %>% arrange(desc(n))
# ë°ì´í„° ì„¸íŠ¸ì— areaì— ë”°ë¥¸ ë°ì´í„° ìˆ˜ íŒŒì•…
count(dustdata_anal, area) %>% arrange(desc(n))
# ì„±ë¶êµ¬ë‚˜ ì¤‘êµ¬ë¥¼ í• ë‹¹
dust_anal_area_sb <- subset(dustdata_anal, area == "ì„±ë¶êµ¬")
dust_anal_area_jg <- subset(dustdata_anal, area == "ì¤‘êµ¬")

dust_anal_area_sb
dust_anal_area_jg

dust_anal_area_sb <- subset(dustdata_anal, area == "ì„±ë¶êµ¬")
dust_anal_area_jg <- subset(dustdata_anal, area == "ì¤‘êµ¬")
#êµ¬ì˜ ë¯¸ì„¸ë¨¼ì§€ëŸ‰ì— ëŒ€í•œ ê¸°ì´ˆ í†µê³„ëŸ‰ ë„ì¶œ
dust_anal_area_sb
dust_anal_area_jg

> describe(dust_anal_area_sb$finedust)
   vars   n  mean    sd median trimmed   mad min max range skew kurtosis   se
X1    1 122 42.75 20.14   39.5   40.34 17.05   9 128   119 1.41     2.93 1.82
> describe(dust_anal_area_jg$finedust)
   vars   n  mean    sd median trimmed   mad min max range skew kurtosis   se
X1    1 122 35.91 17.44   33.5   34.12 15.57   8 112   104 1.33     2.88 1.58

#ë°•ìŠ¤ í”Œë¡¯ì„ ì´ìš©í•œ ë¶„í¬ ì°¨ì´ í™•ì¸
boxplot(dust_anal_area_sb$finedust, dust_anal_area_jg$finedust, main = "finedust_compare",
        xlab = "AREA", names = c("ì„±ë¶êµ¬", "ì¤‘êµ¬"), ylab = "FINEDUST_PM", col = c("blue", "green"))
> t.test(data = dustdata_anal, finedust ~ area, var.equal = T)

	Two Sample t-test

data:  finedust by area
t = 2.8347, df = 242, p-value = 0.004975
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
  2.085657 11.586474
sample estimates:
mean in group ì„±ë¶êµ¬   mean in group ì¤‘êµ¬
            42.74590             35.90984
```
![DeepinìŠ¤í¬ë¦°ìƒ·_select-area_20190916131746](https://i.imgur.com/tjUVrk9.png)
```
view(dustdata)
```
![DeepinìŠ¤í¬ë¦°ìƒ·_select-area_20190916131758](https://i.imgur.com/FKKy4Pt.png)
```
view(dustdata_anal)
```
![DeepinìŠ¤í¬ë¦°ìƒ·_select-area_20190916132417](https://i.imgur.com/0yR15AS.png)

```R
install.packages("twitteR")
library(twitteR)
consumerKey = "key"
consumerSecret = "key"
accessToken = "key"
accessTokenSecret = "key"
# í‚¤ê°’ìœ¼ë¡œ oauth ì¸ì¦
setup_twitter_oauth(consumerKey, consumerSecret, accessToken, accessTokenSecret)

keyword <- enc2utf8("ì›”ë“œì»µ") # ë³€ìˆ˜ í• ë‹¹
bigdata <- searchTwitter(keyword, n = 100, lang = "ko") # 100ê°œ ê²€ìƒ‰
bigdata_df <- twListToDF(bigdata) # ë°ì´íŠ¸ í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜í•˜ê³  í• ë‹¹
str(bigdata_df)
bigdata_text <- bigdata_df$text # ë°ì´í„° ì„¸íŠ¸ êµ¬ì¡° í™•ì¸
head(bigdata_text)

[1] "RT @jinganjang0810: ì˜¤ëŠ˜ ì˜¤í›„ 7ì‹œ 20ë¶„\nì—¬ìë°°êµ¬ ì›”ë“œì»µ í•œì¼ì „ ìˆìŠµë‹ˆë‹¤!!\në§ì€ ì‘ì› ë¶€íƒë“œë¦½ë‹ˆë‹¤ ğŸ https://t.co/kvijE7qs6k"                                                                        
[2] "RT @ShawolsEurope: âœ¨ CUPHOLDER PREVIEW âœ¨\n\n@miracle408923  ê³¼ í•¨ê»˜í•˜ëŠ” ì»µí™€ë” í”„ë¦¬ë·°ì…ë‹ˆë‹¤ ğŸ˜  ë§ì´ ì˜¤ì…”ì„œ ê¸°ë²”ì´ì˜ ìƒì¼ì„ ì¶•í•˜í•´ì£¼ì„¸ìš”ğŸ’• \n\nğŸ“ê¸°ê°„ : 9ì›”22ì¼~9ì›”25ì¼\n\nğŸ“ì¥ì†Œ : ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬â€¦"
[3] "RT @ShawolsEurope: ğŸ‚ #HAPPY_KEY_DAY ğŸ’–\n\n@miracle408923 x @ShawolsEurope âœ¨\n\nJAMSIL AD:\nğŸ“ê¸°ê°„ : 9ì›”18ì¼~10ì›”17ì¼\nğŸ“ì¥ì†Œ : ì ì‹¤ì—­ NO.8 í¬ìŠ¤í„° ê´‘ê³ \nCUPHOLDER EVEâ€¦"                               
[4] "RT @ShawolsEurope: ğŸ‚ #HAPPY_KEY_DAY ğŸ’–\n\n@miracle408923 x @ShawolsEurope âœ¨\n\nJAMSIL AD:\nğŸ“ê¸°ê°„ : 9ì›”18ì¼~10ì›”17ì¼\nğŸ“ì¥ì†Œ : ì ì‹¤ì—­ NO.8 í¬ìŠ¤í„° ê´‘ê³ \nCUPHOLDER EVEâ€¦"                               
[5] "RT @choonkimsix: ë§¨ì¸ë­…ê°™ì€ë…¸ë˜ë¥¼.............. ì „ì„¸ê³„ì¸ì´ëª¨ë¥¸ë‹¤ëŠ”ê±´ì´ê±°ëŠ”ì§„ì§œë…¸ë˜ë‚­ë¹„ê±°ë“ ..........ì˜¬ë¦¼í”½ì£¼ì œê°€.ì›”ë“œì»µì£¼ì œê°€.êµ­ì œê¸°êµ¬UNê³µì‹ì£¼ì œê°€.OECDì• êµ­ê°€ë¡œì„ ì •í•˜ëŠ”ê±°ì–´ë•Œ??"                    
[6] "RT @jinganjang0810: ì˜¤ëŠ˜ ì˜¤í›„ 7ì‹œ 20ë¶„\nì—¬ìë°°êµ¬ ì›”ë“œì»µ í•œì¼ì „ ìˆìŠµë‹ˆë‹¤!!\në§ì€ ì‘ì› ë¶€íƒë“œë¦½ë‹ˆë‹¤ ğŸ https://t.co/kvijE7qs6k"
```

```R
bigdata_noun <- sapply(bigdata_text, extractNoun, USE.NAMES = F) # ëª…ì‚¬ ì¶”ì¶œ
bigdata_noun <- unlist(bigdata_noun) # ë²¡í„°ë¡œ ë³€í™˜

bigdata_noun <- Filter(function(x) { nchar(x) >= 2}, bigdata_noun) # 2ê¸€ì ì´ìƒì˜ ë‹¨ì–´ ì¶”ì¶œ ì €ì¥
bigdata_noun <- gsub("[A-Za-z0-9]", "", bigdata_noun) # ì˜ì–´, ìˆ«ì ì œê±°

bigdata_noun <- gsub("[~!@#$%^&*()-_:+=?:]", bigdata_noun) #íŠ¹ìˆ˜ë¬¸ì ì œê±°
bigdata_noun <- gsub("[ã„±-ã…]", "", bigdata_noun)  #  ã„± ë¶€í„° ã… ê¹Œì§€ ììŒ ì œê±°
bigdata_noun <- gsub("[ã…œ|ã… ]", "", bigdata_noun) # í•œê°œ ì´ìƒì˜ ã…œì™€ ã…  ì œê±°

word_table <- table(bigdata_noun) # ë°ì´í„° ì„¸íŠ¸ í˜•íƒœë¡œ ì €ì¥

library(wordcloud2)
wordcloud2(word_table, fontFamily = "ë§‘ì€ ê³ ë”•", size = 5, color = "random-light", backgroundColor = "black") # ì›Œë“œ í´ë¼ìš°ë“œ í‘œí˜„, random-light ê¸€ì ìƒ‰, ê²€ì€ ë°°ê²½ìƒ‰ ì ìš©
```
![DeepinìŠ¤í¬ë¦°ìƒ·_select-area_20190916135910](https://i.imgur.com/8WlqgwQ.jpg)

```R

station_data <- read.csv("./data/13._ì—­ë³„_ì£¼ì†Œ_ë°_ì „í™”ë²ˆí˜¸.csv")
str(station_data)


googleAPIkey = "key"
register_google("key")

station_code <- as.character(station_data$êµ¬ì£¼ì†Œ)
str(station_code)
station_code <- geocode(station_code)
head(station_code)

station_code <- as.character(station_data$"êµ¬ì£¼ì†Œ") %>% enc2utf8() %>% geocode()
head(station_code)

station_code_final <- cbind(station_data, station_code)
head(station_code_final)

> head(station_code_final)
                ì—­ëª…                    êµ¬ì£¼ì†Œ      lon      lat
1               ì‹œì²­     ì„œìš¸ ì¤‘êµ¬ ì„œì†Œë¬¸ë™ 27 126.9753 37.56389
2         ì„ì§€ë¡œì…êµ¬  ì„œìš¸ ì¤‘êµ¬ ì„ì§€ë¡œ1ê°€ 89-1 126.9826 37.56598
3          ì„ì§€ë¡œ3ê°€  ì„œìš¸ ì¤‘êµ¬ ì„ì§€ë¡œ3ê°€ 70-1 126.9917 37.56613
4          ì„ì§€ë¡œ4ê°€ ì„œìš¸ ì¤‘êµ¬ ì„ì§€ë¡œ4ê°€ 261-1 126.9973 37.56639
5 ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›     ì„œìš¸ ì¤‘êµ¬ ì„ì§€ë¡œ7ê°€ 1 127.0110 37.56728
6               ì‹ ë‹¹   ì„œìš¸ ì¤‘êµ¬ ì‹ ë‹¹5ë™ 106-1 127.0196 37.56565
```

```R
apart_data <- read.csv("./data/zzz.csv", fileEncoding = "CP949", encoding = "UTF-8")
head(apart_data)

apart_data$ì „ìš©ë©´ì  = round(apart_data$ì „ìš©ë©´ì )
head(apart_data)

count(apart_data, ì „ìš©ë©´ì ) %>% arrange(desc(n))

apart_data_85 <- subset(apart_data, ì „ìš©ë©´ì  == "85")
head(apart_data_85)

apart_data_85$ê±°ë˜ê¸ˆì•¡ <- gsub(",", "", apart_data_85$ê±°ë˜ê¸ˆì•¡)
head(apart_data_85)

apart_data_85_cost <- aggregate(as.integer(ê±°ë˜ê¸ˆì•¡) ~ ë‹¨ì§€ëª…, apart_data_85, mean)
head(apart_data_85_cost)

apart_data_85_cost <- rename(apart_data_85_cost, "ê±°ë˜ê¸ˆì•¡" = "as.integer(ê±°ë˜ê¸ˆì•¡)")
head(apart_data_85_cost)

apart_data_85 <- apart_data_85[!duplicated(apart_data_85$ë‹¨ì§€ëª…),]
head(apart_data_85)

apart_data_85 <- left_join(apart_data_85, apart_data_85_cost, by = "ë‹¨ì§€ëª…")
head(apart_data_85)

apart_data_85 <- apart_data_85 %>% select("ë‹¨ì§€ëª…",  "ì‹œêµ°êµ¬", "ë²ˆì§€", "ì „ìš©ë©´ì ", "ê±°ë˜ê¸ˆì•¡.y")

apart_data_85 <- rename(apart_data_85, "ê±°ë˜ê¸ˆì•¡" = "ê±°ë˜ê¸ˆì•¡.y")
head(apart_data_85)

apart_address <- paste(apart_data_85$"ì‹œêµ°êµ¬", apart_data_85$"ë²ˆì§€")
head(apart_address)

apart_address <- paste(apart_data_85$"ì‹œêµ°êµ¬", apart_data_85$"ë²ˆì§€") %>% data.frame()
head(apart_address)

apart_address <- rename(apart_address, "ì£¼ì†Œ" = ".")
head(apart_address)

apart_address_code <- as.character(apart_address$"ì£¼ì†Œ") %>% enc2utf8() %>% geocode()

apart_code_final <- cbind(apart_data_85, apart_address, apart_address_code) %>% select("ë‹¨ì§€ëª…","ì „ìš©ë©´ì ", "ê±°ë˜ê¸ˆì•¡", "ì£¼ì†Œ", lon, lat)
head(apart_code_final)

> head(apart_code_final)
           ë‹¨ì§€ëª… ì „ìš©ë©´ì   ê±°ë˜ê¸ˆì•¡                           ì£¼ì†Œ      lon      lat
1 ê³µë•1ì‚¼ì„±ë˜ë¯¸ì•ˆ       85  87000.00   ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ê³µë•ë™ 371 126.9510 37.54671
2 ê³µë•2ì‚¼ì„±ë˜ë¯¸ì•ˆ       85  78216.67    ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ê³µë•ë™ 43 126.9595 37.55107
3 ê³µë•3ì‚¼ì„±ë˜ë¯¸ì•ˆ       85 102333.33   ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ê³µë•ë™ 457 126.9518 37.54840
4    ê³µë•íŒŒí¬ìì´       85 117000.00   ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ê³µë•ë™ 476 126.9522 37.54687
5        ê³µë•í˜„ëŒ€       85  63525.00 ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ê³µë•ë™ 370-9 126.9500 37.54846
6   ë˜ë¯¸ì•ˆê³µë•5ì°¨       85  90500.00   ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ê³µë•ë™ 469 126.9522 37.54687
```

```R
mapo_map <- get_googlemap("mapogu", maptype = "roadmap", zoom =12)
ggmap(mapo_map)
ggmap(mapo_map) + geom_point(data = station_code_final, aes(x = lon, y = lat),
                             colour = "lightblue", size = 2) + geom_text(data = station_code_final, aes(label = ì—­ëª…, vjust = -1))

hongdae_map <- get_googlemap("hongdae station", maptype= "roadmap", zoom = 15)
ggmap(hongdae_map) + geom_point(data = station_code_final, aes(x = lon, y = lat),
                             colour = "lightblue", size = 2) + geom_text(data= station_code_final, aes(label = ì—­ëª…, vjust = -1)) +
  geom_point(data = apart_code_final, aes(x= lon, y= lat)) + geom_text(data = apart_code_final, aes(label = ë‹¨ì§€ëª…, vjust = -1)) + geom_text(
    data= apart_code_final, aes(label = ê±°ë˜ê¸ˆì•¡, vjust = 1))
```
![DeepinìŠ¤í¬ë¦°ìƒ·_select-area_20190916150319](https://i.imgur.com/YFVvOXm.png)
```
ê¸°ë³¸ ì§€ë„
```
![DeepinìŠ¤í¬ë¦°ìƒ·_select-area_20190916151542](https://i.imgur.com/TKrFMUf.jpg)
```
2í˜¸ì„  ì§€í•˜ì² 
```
![DeepinìŠ¤í¬ë¦°ìƒ·_select-area_20190916152743](https://i.imgur.com/5TFmjmv.jpg)
```
í™ëŒ€ì…êµ¬ì—­ ì£¼ë³€ ì§‘!
```
